<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GoalGuru.ai</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #loader { display: none; }
    #customToast {
      transition: opacity 0.5s ease-in-out;
      opacity: 0;
    }
    .dark body { background-color: #1a202c; color: white; }
    .dark .bg-white { background-color: #2d3748; }
    .dark .text-gray-700, .dark .text-gray-600, .dark .text-gray-900, .dark label { color: #e2e8f0; }
    .dark .border-gray-200 { border-color: #4a5568; }
    .dark .bg-gray-50 { background-color: #2d3748; }
    .dark textarea { background-color: #2d3748; color: white; }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-100 via-white to-pink-100 min-h-screen font-sans transition-colors duration-300">

  <!-- 🔥 Custom Toast -->
  <div id="customToast" class="fixed bottom-6 right-6 bg-green-600 text-white text-sm font-medium px-4 py-3 rounded-lg shadow-lg hidden z-50">
    ✅ Progress saved!
  </div>

  <!-- Your full content here (splash, loader, header, main, etc.) -->
  <!-- 👇 Goal Form and Task Section are same as before -->

  <!-- Footer -->
  <footer class="text-center text-xs text-gray-400 py-6">© 2025 GoalGuru.ai - Made in India 🇮🇳</footer>

  <script>
    function getUserTone() {
      const gender = localStorage.getItem("gender") || "male";
      const age = parseInt(localStorage.getItem("age") || "25");
      if (age >= 50) return "sir/madam";
      return gender === "female" ? "didi" : "bhai";
    }

    function showTaunt() {
      const tone = getUserTone();
      const taunts = {
        "bhai": ["Bhai task toh complete kar! 😑", "Bas goal set kiya?", "AI bhi soch raha 🤨"],
        "didi": ["Didi, task chhod diya kya? 😶", "Goal likh ke bhool gayi kya?", "AI bhi confuse ho gaya 🤨"],
        "sir/madam": ["Sir/Madam, aap se yeh umeed nahi thi 😅", "Thoda discipline dikhaiye 🙏"]
      };
      const list = taunts[tone];
      document.getElementById("tauntBox").innerText = list[Math.floor(Math.random() * list.length)];
    }

    function hideSplash() {
      const splash = document.getElementById("splashScreen");
      splash.classList.add("opacity-0", "transition-opacity", "duration-700");
      setTimeout(() => splash.remove(), 700);
    }

    function toggleDarkMode() {
      document.documentElement.classList.toggle("dark");
      localStorage.setItem("darkmode", document.documentElement.classList.contains("dark") ? "yes" : "no");
    }

    async function generateTask(goal, lang) {
      document.getElementById("loader").style.display = "flex";
      const name = localStorage.getItem("name") || "";
      const age = localStorage.getItem("age") || "";
      const gender = localStorage.getItem("gender") || "";

      const response = await fetch("/generate", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `goal=${encodeURIComponent(goal)}&lang=${encodeURIComponent(lang)}&name=${encodeURIComponent(name)}&age=${encodeURIComponent(age)}&gender=${encodeURIComponent(gender)}`
      });

      const { task } = await response.json();
      localStorage.setItem("task", task);
      localStorage.setItem("task_done", "no");
      location.reload();
    }

    document.getElementById("goalForm").onsubmit = async (e) => {
      e.preventDefault();
      const goal = goalInput.value.trim();
      const lang = localStorage.getItem("lang") || "english";
      localStorage.setItem("goal", goal);
      await generateTask(goal, lang);
    }

    function markCompleted() {
      const progress = (parseInt(localStorage.getItem("progress")) || 0) + 1;
      localStorage.setItem("progress", progress);
      localStorage.setItem("task_done", "yes");

      // ✅ Show toast instead of alert
      const toast = document.getElementById("customToast");
      toast.innerText = `✅ Progress: ${progress}/30`;
      toast.classList.remove("hidden");
      toast.classList.add("opacity-100");

      setTimeout(() => {
        toast.classList.remove("opacity-100");
        setTimeout(() => toast.classList.add("hidden"), 500);
      }, 3000);

      actionBtn.innerText = "🔥 Get New Task";
      actionBtn.disabled = false;
      tauntBox.innerText = "";
    }

    function deleteGoal() {
      localStorage.clear();
      location.reload();
    }

    window.onload = () => {
      if (localStorage.getItem("darkmode") === "yes") document.documentElement.classList.add("dark");

      const goal = localStorage.getItem("goal");
      const lang = localStorage.getItem("lang");
      const savedTask = localStorage.getItem("task");
      const done = localStorage.getItem("task_done");
      const progress = parseInt(localStorage.getItem("progress") || 0);

      if (goal && lang) {
        savedInfo.classList.remove("hidden");
        savedGoalText.innerText = goal;
        savedLangText.innerText = lang;
        goalInput.value = goal;
        progressCount.innerText = progress;
        progressBar.style.width = `${(progress / 30) * 100}%`;
        if (progress >= 3) encourage.classList.remove("hidden");
      }

      if (savedTask) {
        taskText.innerText = savedTask;
        taskSection.classList.remove("hidden");
      }

      if (done === "no") {
        actionBtn.innerText = "⚠️ Complete current task first!";
        actionBtn.disabled = true;
        showTaunt();
      } else {
        actionBtn.innerText = "🔥 Get New Task";
        actionBtn.disabled = false;
      }

      if (!localStorage.getItem("task")) {
        actionBtn.innerText = "🔥 Get Today’s AI Task";
        actionBtn.disabled = false;
      }

      setTimeout(hideSplash, 6000);
    }
  </script>
</body>
</html>
