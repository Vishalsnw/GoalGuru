<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GoalGuru.ai</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCrhiivmQr0cMW6KJ2X366_zfMil_Yktuo",
      authDomain: "goalguru-e0e30.firebaseapp.com",
      projectId: "goalguru-e0e30",
      storageBucket: "goalguru-e0e30.appspot.com",
      messagingSenderId: "655564345934",
      appId: "1:655564345934:web:9a36e84b109e176978291f",
      measurementId: "G-ZGNT32YDR3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const USER_ID = "user_001";

    window.saveToFirebase = async function(goal, lang, task, progress) {
      await setDoc(doc(db, "users", USER_ID), {
        goal,
        lang,
        task,
        progress,
        last_updated: new Date()
      });
    }

    window.loadFromFirebase = async function() {
      const docSnap = await getDoc(doc(db, "users", USER_ID));
      if (docSnap.exists()) {
        const data = docSnap.data();
        document.getElementById("savedGoalText").innerText = data.goal || "";
        document.getElementById("savedLangText").innerText = data.lang || "english";
        document.getElementById("progressCount").innerText = data.progress || "0";
        document.getElementById("progressBar").style.width = `${(data.progress / 30) * 100}%`;
        if (data.goal) document.getElementById("savedInfo").classList.remove("hidden");
        if (data.task) {
          document.getElementById("taskText").innerText = data.task;
          document.getElementById("taskSection").classList.remove("hidden");
        }
      }
    }
  </script>
  <style>
    #loader { display: none; }
    #customToast, #reminderToast {
      opacity: 0;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.95);
      transition: opacity 0.5s ease, transform 0.5s ease;
      padding: 1rem 1.5rem;
      font-weight: 600;
      border-radius: 0.75rem;
      box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
      z-index: 9999;
      text-align: center;
      max-width: 80%;
    }
    #customToast.show, #reminderToast.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
    #customToast { background-color: #16a34a; color: white; }
    #reminderToast { background-color: #dc2626; color: white; }
    .dark body { background-color: #1a202c; color: white; }
    .dark .bg-white { background-color: #2d3748; }
    .dark .text-gray-700, .dark .text-gray-600, .dark .text-gray-900, .dark label { color: #e2e8f0; }
    .dark .border-gray-200 { border-color: #4a5568; }
    .dark .bg-gray-50 { background-color: #2d3748; }
    .dark textarea { background-color: #2d3748; color: white; }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-100 via-white to-pink-100 min-h-screen font-sans transition-colors duration-300">

<div id="customToast">‚úÖ Progress saved!</div>
<div id="reminderToast"></div>

<div id="splashScreen" class="fixed inset-0 z-50 flex items-center justify-center bg-black">
  <video autoplay muted playsinline onended="hideSplash()" class="w-full h-full object-cover">
    <source src="/static/splash.mp4" type="video/mp4">
  </video>
</div>

<div id="loader" class="fixed inset-0 z-40 flex items-center justify-center bg-white bg-opacity-90 dark:bg-black dark:bg-opacity-90">
  <div class="flex flex-col items-center gap-2">
    <div class="w-10 h-10 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"></div>
    <p class="text-indigo-600 text-sm font-medium mt-2">Generating your AI task...</p>
  </div>
</div>

<header class="bg-indigo-600 text-white py-4 shadow-md sticky top-0 z-30">
  <div class="max-w-4xl mx-auto px-4 flex justify-between items-center">
    <h1 class="text-2xl font-bold">üéØ GoalGuru</h1>
    <div class="relative group">
      <button class="text-sm font-medium bg-white text-indigo-600 px-2 py-1 rounded">‚ò∞ Menu</button>
      <div class="absolute right-0 mt-2 hidden group-hover:block bg-white text-gray-700 shadow-lg rounded-md overflow-hidden z-20 dark:bg-gray-800">
        <a href="#goalForm" class="block px-4 py-2 text-sm hover:bg-indigo-100 dark:hover:bg-indigo-900">üéØ Set New Goal</a>
        <a href="#savedInfo" class="block px-4 py-2 text-sm hover:bg-indigo-100 dark:hover:bg-indigo-900">üìä View Progress</a>
        <a href="javascript:void(0)" onclick="showGoalPlan()" class="block px-4 py-2 text-sm hover:bg-indigo-100 dark:hover:bg-indigo-900">üìç Full Goal Plan</a>
        <a href="javascript:void(0)" onclick="toggleDarkMode()" class="block px-4 py-2 text-sm hover:bg-indigo-100 dark:hover:bg-indigo-900">üåì Toggle Dark Mode</a>
        <a href="javascript:void(0)" onclick="deleteGoal()" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-100 dark:hover:bg-red-900">üóëÔ∏è Reset Everything</a>
      </div>
    </div>
  </div>
</header>

<!-- The rest of main content and forms remain same as your original, with markCompleted calling saveToFirebase -->

<script>
function hideSplash() {
  const splash = document.getElementById("splashScreen");
  if (!splash) return;
  splash.classList.add("opacity-0", "transition-opacity", "duration-700");
  setTimeout(() => splash.remove(), 700);
}

function updateProgressUI() {
  const progress = parseInt(localStorage.getItem("progress") || "0");
  const total = parseInt(localStorage.getItem("totalTasks") || "30");
  document.getElementById("progressCount").innerText = progress;
  document.getElementById("totalTasks").innerText = total;
  document.getElementById("progressBar").style.width = `${(progress / total) * 100}%`;
  if (progress >= 10) {
    document.getElementById("encourage").classList.remove("hidden");
  }
}

function toggleDarkMode() {
  document.documentElement.classList.toggle("dark");
  localStorage.setItem("darkmode", document.documentElement.classList.contains("dark") ? "yes" : "no");
}

function deleteGoal() {
  localStorage.clear();
  location.reload();
}

window.onload = async () => {
  if (localStorage.getItem("darkmode") === "yes") {
    document.documentElement.classList.add("dark");
  }
  await loadFromFirebase();
  setTimeout(hideSplash, 6000);
};

async function markCompleted() {
  if (localStorage.getItem("task_done") === "yes") return;
  let count = parseInt(localStorage.getItem("progress") || "0") + 1;
  localStorage.setItem("progress", count);
  localStorage.setItem("task_done", "yes");
  updateProgressUI();
  await saveToFirebase(
    localStorage.getItem("goal"),
    localStorage.getItem("lang"),
    localStorage.getItem("task"),
    count
  );
  document.getElementById("customToast").classList.add("show");
  setTimeout(() => document.getElementById("customToast").classList.remove("show"), 2500);
}
</script>

</body>
</html>
