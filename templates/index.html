<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GoalGuru.ai</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCrhiivmQr0cMW6KJ2X366_zfMil_Yktuo",
      authDomain: "goalguru-e0e30.firebaseapp.com",
      projectId: "goalguru-e0e30",
      storageBucket: "goalguru-e0e30.appspot.com",
      messagingSenderId: "655564345934",
      appId: "1:655564345934:web:9a36e84b109e176978291f",
      measurementId: "G-ZGNT32YDR3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const USER_ID = "user_001";

    window.saveToFirebase = async function(goal, lang, task, progress) {
      await setDoc(doc(db, "users", USER_ID), {
        goal,
        lang,
        task,
        progress,
        last_updated: new Date()
      });
    }

    window.loadFromFirebase = async function() {
      const docSnap = await getDoc(doc(db, "users", USER_ID));
      if (docSnap.exists()) {
        const data = docSnap.data();
        document.getElementById("savedGoalText").innerText = data.goal || "";
        document.getElementById("savedLangText").innerText = data.lang || "english";
        document.getElementById("progressCount").innerText = data.progress || "0";
        document.getElementById("progressBar").style.width = `${(data.progress / 30) * 100}%`;
        if (data.goal) document.getElementById("savedInfo").classList.remove("hidden");
        if (data.task) {
          document.getElementById("taskText").innerText = data.task;
          document.getElementById("taskSection").classList.remove("hidden");
        }
      }
    }
  </script>
</head>
<body>
  <!-- Keep your entire HTML here, no change needed -->

  <script>
    window.onload = async () => {
      if (localStorage.getItem("darkmode") === "yes") {
        document.documentElement.classList.add("dark");
      }
      await loadFromFirebase();

      const goal = localStorage.getItem("goal");
      const task = localStorage.getItem("task");
      if (goal) {
        document.getElementById("savedGoalText").innerText = goal;
        document.getElementById("savedLangText").innerText = localStorage.getItem("lang") || "english";
        document.getElementById("savedInfo").classList.remove("hidden");
        updateProgressUI();
      }
      if (task) {
        document.getElementById("taskText").innerText = task;
        document.getElementById("taskSection").classList.remove("hidden");
      }
      if (localStorage.getItem("roadmap_shown") !== "yes") {
        document.getElementById("roadmapSection").classList.add("hidden");
      }
      setTimeout(hideSplash, 6000);
    };

    async function markCompleted() {
      if (localStorage.getItem("task_done") === "yes") return;
      let count = parseInt(localStorage.getItem("progress") || "0") + 1;
      localStorage.setItem("progress", count);
      localStorage.setItem("task_done", "yes");
      updateProgressUI();
      await saveToFirebase(
        localStorage.getItem("goal"),
        localStorage.getItem("lang"),
        localStorage.getItem("task"),
        count
      );
      document.getElementById("customToast").classList.add("show");
      setTimeout(() => document.getElementById("customToast").classList.remove("show"), 2500);
    }
  </script>
</body>
</html>
