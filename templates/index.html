<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GoalGuru.ai</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCrhiivmQr0cMW6KJ2X366_zfMil_Yktuo",
      authDomain: "goalguru-e0e30.firebaseapp.com",
      projectId: "goalguru-e0e30",
      storageBucket: "goalguru-e0e30.appspot.com",
      messagingSenderId: "655564345934",
      appId: "1:655564345934:web:9a36e84b109e176978291f",
      measurementId: "G-ZGNT32YDR3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const USER_ID = "user_001";

    window.saveToFirebase = async function(goal, lang, task, progress) {
      await setDoc(doc(db, "users", USER_ID), {
        goal,
        lang,
        task,
        progress,
        last_updated: new Date()
      });
    }

    window.loadFromFirebase = async function() {
      const docSnap = await getDoc(doc(db, "users", USER_ID));
      if (docSnap.exists()) {
        const data = docSnap.data();
        document.getElementById("savedGoalText").innerText = data.goal || "";
        document.getElementById("savedLangText").innerText = data.lang || "english";
        document.getElementById("progressCount").innerText = data.progress || "0";
        document.getElementById("progressBar").style.width = `${(data.progress / 30) * 100}%`;
        if (data.goal) document.getElementById("savedInfo").classList.remove("hidden");
        if (data.task) {
          document.getElementById("taskText").innerText = data.task;
          document.getElementById("taskSection").classList.remove("hidden");
        }
        localStorage.setItem("goal", data.goal || "");
        localStorage.setItem("lang", data.lang || "english");
        localStorage.setItem("task", data.task || "");
        localStorage.setItem("progress", data.progress || "0");
        localStorage.setItem("task_done", "no");
      }
    }
  </script>
  <style>
    #loader { display: none; }
    #customToast {
      opacity: 0; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95);
      transition: opacity 0.5s ease, transform 0.5s ease;
      padding: 1rem 1.5rem; font-weight: 600; border-radius: 0.75rem;
      background-color: #16a34a; color: white;
      z-index: 9999; text-align: center; max-width: 80%;
    }
    #customToast.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-100 via-white to-pink-100 min-h-screen font-sans">

<div id="customToast">‚úÖ Progress saved!</div>

<div id="splashScreen" class="fixed inset-0 z-50 flex items-center justify-center bg-black">
  <video autoplay muted playsinline onended="hideSplash()" class="w-full h-full object-cover">
    <source src="/static/splash.mp4" type="video/mp4">
  </video>
</div>

<div id="loader" class="fixed inset-0 z-40 flex items-center justify-center bg-white bg-opacity-90">
  <div class="flex flex-col items-center gap-2">
    <div class="w-10 h-10 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"></div>
    <p class="text-indigo-600 text-sm font-medium mt-2">Generating your AI task...</p>
  </div>
</div>

<header class="bg-indigo-600 text-white py-4 shadow-md sticky top-0 z-30">
  <div class="max-w-4xl mx-auto px-4 flex justify-between items-center">
    <h1 class="text-2xl font-bold">üéØ GoalGuru</h1>
    <div class="relative group">
      <button class="text-sm font-medium bg-white text-indigo-600 px-2 py-1 rounded">‚ò∞ Menu</button>
      <div class="absolute right-0 mt-2 hidden group-hover:block bg-white text-gray-700 shadow-lg rounded-md overflow-hidden z-20">
        <a href="#goalForm" class="block px-4 py-2 text-sm hover:bg-indigo-100">üéØ Set New Goal</a>
        <a href="#savedInfo" class="block px-4 py-2 text-sm hover:bg-indigo-100">üìä View Progress</a>
        <a href="javascript:void(0)" onclick="toggleDarkMode()" class="block px-4 py-2 text-sm hover:bg-indigo-100">üåì Toggle Dark Mode</a>
        <a href="javascript:void(0)" onclick="deleteGoal()" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-100">üóëÔ∏è Reset Everything</a>
      </div>
    </div>
  </div>
</header>

<main class="max-w-2xl mx-auto px-4 py-10">
  <div class="bg-white shadow-2xl rounded-3xl p-8 space-y-6 border border-gray-200">
    <p class="text-center text-gray-600 text-sm">Your desi AI accountability buddy</p>

    <div id="savedInfo" class="hidden bg-gray-50 p-4 rounded-xl text-sm border space-y-2">
      <p><strong>Your Goal:</strong> <span id="savedGoalText"></span></p>
      <p><strong>Language:</strong> <span id="savedLangText"></span></p>
      <p><strong>Progress:</strong> <span id="progressCount">0</span>/30</p>
      <div class="w-full bg-gray-200 rounded-full h-3">
        <div id="progressBar" class="bg-indigo-500 h-3 rounded-full" style="width: 0%"></div>
      </div>
    </div>

    <form id="goalForm" class="space-y-4">
      <div>
        <label class="block text-sm font-medium">Your Goal:</label>
        <textarea id="goalInput" required placeholder="I want to become rich" class="mt-1 block w-full rounded-lg border p-3"></textarea>
      </div>
      <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg">üî• Get Today‚Äôs AI Task</button>
    </form>

    <div id="taskSection" class="hidden">
      <div class="bg-indigo-50 p-4 rounded-xl border space-y-4">
        <h3 class="text-lg font-semibold text-indigo-700">üß† Today's Task</h3>
        <blockquote id="taskText" class="italic p-4 bg-white rounded-xl shadow border-l-4 border-indigo-500"></blockquote>
        <div class="flex gap-3">
          <button onclick="markCompleted()" class="bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded">‚úÖ Mark Done</button>
        </div>
      </div>
    </div>
  </div>
</main>

<footer class="text-center text-xs text-gray-400 py-6">¬© 2025 GoalGuru.ai - Made in India üáÆüá≥</footer>

<script>
function hideSplash() {
  const splash = document.getElementById("splashScreen");
  if (!splash) return;
  splash.classList.add("opacity-0", "transition-opacity", "duration-700");
  setTimeout(() => splash.remove(), 700);
}

function toggleDarkMode() {
  document.documentElement.classList.toggle("dark");
  localStorage.setItem("darkmode", document.documentElement.classList.contains("dark") ? "yes" : "no");
}

function deleteGoal() {
  localStorage.clear();
  location.reload();
}

async function markCompleted() {
  if (localStorage.getItem("task_done") === "yes") return;
  let count = parseInt(localStorage.getItem("progress") || "0") + 1;
  localStorage.setItem("progress", count);
  localStorage.setItem("task_done", "yes");
  document.getElementById("progressCount").innerText = count;
  document.getElementById("progressBar").style.width = `${(count / 30) * 100}%`;
  await saveToFirebase(
    localStorage.getItem("goal"),
    localStorage.getItem("lang"),
    localStorage.getItem("task"),
    count
  );
  document.getElementById("customToast").classList.add("show");
  setTimeout(() => document.getElementById("customToast").classList.remove("show"), 2500);
}

window.onload = async () => {
  if (localStorage.getItem("darkmode") === "yes") {
    document.documentElement.classList.add("dark");
  }
  await loadFromFirebase();
  setTimeout(hideSplash, 6000);
};

document.getElementById("goalForm").onsubmit = async (e) => {
  e.preventDefault();
  const goal = document.getElementById("goalInput").value.trim();
  const lang = "english";
  document.getElementById("loader").style.display = "flex";

  const res = await fetch("/generate", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams({ goal, lang })
  });
  const { task } = await res.json();
  localStorage.setItem("goal", goal);
  localStorage.setItem("lang", lang);
  localStorage.setItem("task", task);
  localStorage.setItem("progress", "0");
  localStorage.setItem("task_done", "no");
  document.getElementById("taskText").innerText = task;
  document.getElementById("taskSection").classList.remove("hidden");
  document.getElementById("savedGoalText").innerText = goal;
  document.getElementById("savedLangText").innerText = lang;
  document.getElementById("savedInfo").classList.remove("hidden");
  await saveToFirebase(goal, lang, task, 0);
  document.getElementById("loader").style.display = "none";
};
</script>
</body>
  </html>
  
